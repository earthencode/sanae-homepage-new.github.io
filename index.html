<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>bloom</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="x-icon" href="favicon.png">
</head>

<body>

    <div class="container">

        <p class="greeting">„Åì„Çì„Å´„Å°„ÅØ!</p>

        <p>
            social;
            <a href="https://www.youtube.com/">youtube</a> /
            <a href="https://www.discord.com/app/">discord</a> /
            <a href="https://reddit.com">reddit</a>
        </p>

        <p>
            music;
            <a href="https://www.soundcloud.com/">soundcloud</a> /
            <a href="https://music.youtube.com">youtube</a> /
            <a href="https://sanae.bandcamp.com">bandcamp</a>
        </p>

        <p>
            database;
            <a href="https://rutracker.org/forum/index.php">tracker</a> /
            <a href="https://ext.to/">ext</a> /
            <a href="https://eztvx.to/home">eztv</a> /
            <a href="https://cs.rin.ru/forum/">rin</a>
        </p>

        <p>
            misc;
            <a href="https://www.photopea.com/">photopea</a> /
            <a href="https://www.idokep.hu/elorejelzes/Koml%C3%B3">weather</a>
        </p>

        <div class="search-container">
            <input type="text" id="search-text" placeholder="search" value="" autofocus>
            <div id="autocomplete-list" class="autocomplete-items"></div>
        </div>
    </div>

    <div class="gif">
        <img src="vagabond.png" />
    </div>


    <script>
        // Search bar functionality
        /*    const searchInput = document.getElementById('search-text');
            let searchQuery = '';
    
            // Function to validate if a string is a URL
            function isValidUrl(string) {
                const urlRegex = /^(https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/[a-zA-Z0-9]+\.[^\s]{2,}|[a-zA-Z0-9]+\.[^\s]{2,})$/i;
                return urlRegex.test(string);
            }
    
            searchInput.addEventListener('keydown', function (event) {
                if (event.key === 'Enter') {
                    if (isValidUrl(this.value)) {
                        let urlToOpen = this.value;
                        if (!urlToOpen.startsWith('http://') && !urlToOpen.startsWith('https://')) {
                            urlToOpen = `http://${urlToOpen}`;
                        }
                        document.location.href = urlToOpen
                    } else {
                        document.location.href = `https://www.google.com/search?q=${encodeURIComponent(this.value)}`;
                    }
                }
            }); */

        const searchInput = document.getElementById('search-text');
        const list = document.getElementById('autocomplete-list');
        const MAX_HISTORY = 10;
        let currentFocus = -1;

        // Function to validate if a string is a URL
        function isValidUrl(string) {
            const urlRegex = /^(https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/[a-zA-Z0-9]+\.[^\s]{2,}|[a-zA-Z0-9]+\.[^\s]{2,})$/i;
            return urlRegex.test(string);
        }

        function getHistory() {
            return JSON.parse(localStorage.getItem('searchHistory')) || [];
        }

        function saveToHistory(query) {
            let history = getHistory();
            query = query.trim();
            if (!query || history.includes(query)) return;

            history.unshift(query);
            if (history.length > MAX_HISTORY) history.pop();

            localStorage.setItem('searchHistory', JSON.stringify(history));
        }

        async function getGoogleSuggestions(query) {
            try {
                const response = await fetch(
                    `https://corsproxy.io/?https://suggestqueries.google.com/complete/search?client=firefox&q=${encodeURIComponent(query)}`
                );
                const data = await response.json();
                return data[1].map(s => ({ type: 'remote', value: s }));
            } catch (error) {
                console.error('Google Suggest fetch error:', error);
                return [];
            }
        }

        async function showSuggestions(query) {
            list.innerHTML = '';
            currentFocus = -1;
            if (!query) return;

            const local = getHistory()
                .filter(item => item.toLowerCase().includes(query.toLowerCase()))
                .map(item => ({ type: 'local', value: item }));

            const remote = await getGoogleSuggestions(query);
            const allSuggestions = [...local, ...remote];

            allSuggestions.forEach((item, index) => {
                const div = document.createElement('div');
                div.setAttribute('data-index', index);
                div.classList.add('autocomplete-item');

                const matchIndex = item.value.toLowerCase().indexOf(query.toLowerCase());
                const before = item.value.slice(0, matchIndex);
                const match = item.value.slice(matchIndex, matchIndex + query.length);
                const after = item.value.slice(matchIndex + query.length);

                const icon = item.type === 'local'
                    ? (isValidUrl(item.value) ? 'üîó' : 'üß†')
                    : 'üîç';

                div.innerHTML = `${icon} ${before}<strong>${match}</strong>${after}`;

                div.addEventListener('click', () => {
                    searchInput.value = item.value;
                    list.innerHTML = '';
                });

                list.appendChild(div);
            });
        }

        function addActive() {
            const items = list.getElementsByClassName('autocomplete-item');
            removeActive();

            if (!items.length) return;

            if (currentFocus >= items.length) currentFocus = 0;
            if (currentFocus < 0) currentFocus = items.length - 1;

            const activeItem = items[currentFocus];
            activeItem.classList.add('active');

            // ‚úÖ Ensure it's visible in scroll area
            activeItem.scrollIntoView({ block: 'nearest' });
        }

        function removeActive() {
            const items = list.getElementsByClassName('autocomplete-item');
            for (let i = 0; i < items.length; i++) {
                items[i].classList.remove('active');
            }
        }

        // Detect input
        searchInput.addEventListener('input', () => {
            showSuggestions(searchInput.value);
        });

        // Close suggestions when clicking outside
        document.addEventListener('click', (e) => {
            if (e.target !== searchInput) list.innerHTML = '';
        });

        // Handle Enter key
        searchInput.addEventListener('keydown', function (event) {
            if (event.key === 'ArrowDown') {
                currentFocus++;
                addActive();
                event.preventDefault();
            } else if (event.key === 'ArrowUp') {
                currentFocus--;
                addActive();
                event.preventDefault();
            } else if (event.key === 'Enter') {
                const items = list.getElementsByClassName('autocomplete-item');
                if (currentFocus > -1 && items[currentFocus]) {
                    event.preventDefault();
                    items[currentFocus].click();
                    return;
                }

                const value = this.value.trim();
                if (!value) return;
                saveToHistory(value);

                if (isValidUrl(value)) {
                    let urlToOpen = value;
                    if (!urlToOpen.startsWith('http://') && !urlToOpen.startsWith('https://')) {
                        urlToOpen = `http://${urlToOpen}`;
                    }
                    document.location.href = urlToOpen;
                } else {
                    document.location.href = `https://www.google.com/search?q=${encodeURIComponent(value)}`;
                }
            }
        });
    </script>
</body>

</html>